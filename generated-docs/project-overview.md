Last updated: 2026-01-08

# Project Overview

## プロジェクト概要
- アクティブなウィンドウを監視し、生産性を可視化するスタンドアロンツールです。
- ウィンドウタイトルに基づきスコアを増減させ、ユーザーの集中度合いをフィードバックします。
- tkinterによるシンプルなGUI、正規表現による柔軟な設定、クロスプラットフォーム対応が特徴です。

## 技術スタック
- フロントエンド: **tkinter**: Python標準のGUIツールキットで、シンプルかつ軽量なユーザーインターフェースを提供します。
- 音楽・オーディオ: 該当する技術は使用されていません。
- 開発ツール:
    - **Git**: バージョン管理システムとしてコードの変更履歴を管理し、共同開発をサポートします。
    - **ruff**: Pythonコードのフォーマットとリンティングを行い、コード品質と一貫性を保ちます。
    - **Visual Studio Code**: 開発者のための統合開発環境（IDE）であり、`.vscode/settings.json`でプロジェクト固有の設定が定義されています。
- テスト: **unittest**: Python標準のテストフレームワークで、各モジュールの機能が期待通りに動作するかを検証します。
- ビルドツール: 該当するビルドツールは使用されていません（Pythonスクリプトとして直接実行されます）。
- 言語機能:
    - **Python 3.12+**: アプリケーションの主要な開発言語であり、最新の言語機能とパフォーマンスを利用しています。
    - **正規表現 (reモジュール)**: ウィンドウタイトルをパターンマッチングするために使用され、柔軟な条件設定を可能にします。
    - **TOML**: 設定ファイル（`config.toml`）の記述形式として採用されており、人間が読みやすく、構造化された設定を可能にします。
    - **OS固有API (xdotool/xprop, AppleScript, pywin32)**: 各オペレーティングシステム（Linux, macOS, Windows）でアクティブなウィンドウタイトルを取得するために利用されます。
- 自動化・CI/CD: **pre-commit**: コミット前にコードの自動フォーマットやリンティングを実行し、コード品質の低下を防ぎます。
- 開発標準:
    - **.editorconfig**: 異なるエディタやIDE間で一貫したコーディングスタイル（インデント、改行コードなど）を強制します。
    - **ruff**: コードリンティングとフォーマットを通じて、Pythonのベストプラクティスとプロジェクト固有のコーディング規約を適用します。

## ファイル階層ツリー
```
📄 .editorconfig
📄 .gitignore
📄 .pre-commit-config.yaml
📁 .vscode/
  📊 settings.json
📄 LICENSE
📖 README.ja.md
📖 README.md
📄 _config.yml
📄 config.toml.example
📁 examples/
  📄 example.txt
📁 generated-docs/
📁 issue-notes/
  📖 11.md
  📖 12.md
  📖 13.md
  📖 14.md
  📖 15.md
  📖 16.md
  📖 21.md
  📖 26.md
  📖 27.md
  📖 29.md
  📖 31.md
  📖 33.md
  📖 34.md
  📖 37.md
  📖 39.md
  📖 4.md
  📖 40.md
  📖 43.md
  📖 45.md
  📖 46.md
  📖 48.md
  📖 50.md
  📖 53.md
  📖 55.md
  📖 57.md
  📖 58.md
  📖 59.md
  📖 6.md
  📖 60.md
  📖 61.md
  📖 8.md
  📖 9.md
📄 pytest.ini
📄 ruff.toml
📁 src/
  📄 __init__.py
  📄 __main__.py
  📄 config.py
  📄 constants.py
  📄 gui.py
  📄 main.py
  📄 score_tracker.py
  📄 window_monitor.py
📁 tests/
  📄 test_config.py
  📄 test_dummy.py
  📄 test_gui.py
  📄 test_score_colors.py
  📄 test_score_tracker.py
  📄 test_window_monitor.py
```

## ファイル詳細説明
- **.editorconfig**: 異なるエディタやIDE間でコードの一貫したスタイル（インデントサイズ、改行コードなど）を定義します。
- **.gitignore**: Gitが追跡すべきでないファイルやディレクトリ（例: ログファイル、一時ファイル）を指定します。
- **.pre-commit-config.yaml**: pre-commitフックの設定ファイルで、コミット前に実行される自動フォーマットやリンティングツールを定義します。
- **.vscode/settings.json**: Visual Studio Codeのワークスペース固有の設定ファイルで、開発環境を統一するために使用されます。
- **LICENSE**: プロジェクトのライセンス情報が記述されています。ソフトウェアの使用、配布、変更に関する条件を明示します。
- **README.ja.md**: プロジェクトの概要、機能、インストール、使用方法などが日本語で記述された説明書です。
- **README.md**: プロジェクトの概要、機能、インストール、使用方法などが英語で記述された説明書です。
- **_config.yml**: GitHub Pagesなどの静的サイトジェネレーターの設定ファイルである可能性がありますが、このプロジェクトでは直接的な役割は不明です。
- **config.toml.example**: アプリケーションの設定ファイル（`config.toml`）の例です。ウィンドウパターンやスコア調整ルールなどをカスタマイズする方法を示します。
- **examples/**: プロジェクトに関連する使用例やデータが含まれるディレクトリです。
    - **example.txt**: サンプルのテキストファイルです。
- **generated-docs/**: 自動生成されたドキュメントが格納されるディレクトリです。
- **issue-notes/**: 開発過程で発生した課題や検討事項に関するメモが格納されているディレクトリです。
- **pytest.ini**: pytestテストフレームワークの設定ファイルですが、unittestが使用されているため、ここではテスト実行に関する追加設定が含まれる可能性があります。
- **ruff.toml**: ruffリンターおよびフォーマッターの設定ファイルで、Pythonコードの品質とスタイルに関するルールを定義します。
- **src/__init__.py**: `src`ディレクトリがPythonパッケージであることを示します。
- **src/__main__.py**: `python -m src`のようにモジュールとして実行された際のエントリポイントとなります。通常は`main.py`を呼び出します。
- **src/config.py**: TOML形式の設定ファイル（`config.toml`）を読み込み、アプリケーション全体で利用可能な設定オブジェクトとして管理します。
- **src/constants.py**: アプリケーション全体で共有される定数（例: デフォルト値、マジックナンバーなど）を定義します。
- **src/gui.py**: `tkinter`ライブラリを使用して、スコア表示や現在のアクティビティを表示するユーザーインターフェースを構築・管理します。
- **src/main.py**: アプリケーションの主要なエントリポイントです。設定の読み込み、GUIの初期化、ウィンドウ監視ループの開始など、各モジュールを統合してアプリケーション全体の処理をオーケストレーションします。
- **src/score_tracker.py**: `window_monitor`から取得したウィンドウタイトルと`config`で定義されたパターンをマッチさせ、スコアの増減を計算・追跡するロジックを実装します。
- **src/window_monitor.py**: OSごとのAPI（Linuxのxdotool/xprop、macOSのAppleScript、WindowsのAPI）を抽象化し、現在アクティブなウィンドウのタイトルを取得する機能を提供します。
- **tests/**: アプリケーションの各モジュールに対する単体テストファイルが格納されています。
    - **test_config.py**: `config.py`モジュールのテストを行います。
    - **test_dummy.py**: ダミーのテストファイルです。
    - **test_gui.py**: `gui.py`モジュールのテストを行います。
    - **test_score_colors.py**: スコアの色表示に関するテストを行います。
    - **test_score_tracker.py**: `score_tracker.py`モジュールのテストを行います。
    - **test_window_monitor.py**: `window_monitor.py`モジュールのテストを行います。

## 関数詳細説明
このプロジェクトでは、主に以下の役割を持つ関数群が存在すると考えられます。具体的な引数や戻り値は、実装の詳細に依存するため一般的な説明に留めます。

- **`main.py`内の関数:**
    - `main()`:
        - **役割**: アプリケーションの起動と主要な実行フローを管理します。設定の読み込み、GUIの初期化、ウィンドウ監視とスコア更新のループを開始します。
        - **引数**: アプリケーション起動時のコマンドライン引数（設定ファイルのパスなど）を受け取ることがあります。
        - **戻り値**: なし
    - `parse_args()`:
        - **役割**: コマンドライン引数を解析し、アプリケーションの設定オプション（例: カスタム設定ファイルのパス）を抽出します。
        - **引数**: なし（またはシステムから直接引数を取得）
        - **戻り値**: 解析された引数を格納したオブジェクト

- **`config.py`内の関数:**
    - `load_config(config_path=None)`:
        - **役割**: 指定されたパスからTOML形式の設定ファイルを読み込み、アプリケーションで使用する設定辞書を構築します。デフォルト設定の適用やバリデーションも行います。
        - **引数**: `config_path` (str, オプション): 読み込む設定ファイルのパス。指定しない場合はデフォルトのパス（`config.toml`）を使用します。
        - **戻り値**: 設定情報を格納した辞書またはオブジェクト
    - `get_setting(key, default=None)`:
        - **役割**: ロードされた設定から指定されたキーの値を取得します。キーが存在しない場合はデフォルト値を返します。
        - **引数**: `key` (str): 取得したい設定のキー。`default` (any, オプション): キーが存在しない場合に返すデフォルト値。
        - **戻り値**: 指定されたキーの値、またはデフォルト値

- **`window_monitor.py`内の関数:**
    - `get_active_window_title()`:
        - **役割**: 現在アクティブな（フォーカスされている）ウィンドウのタイトルを、OS固有のメカニズムを使用して取得します。クロスプラットフォーム対応のため、内部でOS判定を行います。
        - **引数**: なし
        - **戻り値**: 現在のアクティブウィンドウのタイトル (str)、または取得できなかった場合は空文字列かNone

- **`score_tracker.py`内の関数:**
    - `ScoreTracker(config)` (クラスのコンストラクタ):
        - **役割**: スコア追跡ロジックを初期化します。設定ファイルからウィンドウパターンとスコアルールをロードします。
        - **引数**: `config` (dict): ロードされた設定情報。
        - **戻り値**: ScoreTrackerのインスタンス
    - `update_score(window_title)`:
        - **役割**: 与えられたウィンドウタイトルに基づいて、スコアを更新します。設定された正規表現パターンとマッチングを行い、対応するスコア増減を適用します。
        - **引数**: `window_title` (str): 現在アクティブなウィンドウのタイトル。
        - **戻り値**: 更新後の現在のスコア (int)
    - `get_current_status()`:
        - **役割**: 現在マッチしているパターンに関する説明と、そのパターンに紐づくスコア増減情報を取得します。
        - **引数**: なし
        - **戻り値**: 現在の活動を示す説明文字列 (str)

- **`gui.py`内の関数:**
    - `create_gui(root, score_tracker, config)`:
        - **役割**: Tkinterのルートウィンドウを構築し、スコアとステータスを表示するUI要素を配置します。各種設定（常に最前面、マウス接近時非表示など）も適用します。
        - **引数**: `root` (tkinter.Tk): Tkinterのルートウィンドウ。`score_tracker` (ScoreTrackerインスタンス): スコア情報を提供するオブジェクト。`config` (dict): アプリケーション設定。
        - **戻り値**: UI要素を管理するGUIオブジェクトまたはフレーム
    - `update_display(score, status_text, color)`:
        - **役割**: GUI上のスコア表示とステータステキストを更新します。スコアの増減に応じて表示色も変更します。
        - **引数**: `score` (int): 表示する現在のスコア。`status_text` (str): 表示する現在の活動ステータス。`color` (str): スコア表示のカラーコード。
        - **戻り値**: なし
    - `start_gui_loop()`:
        - **役割**: Tkinterのイベントループを開始し、GUIアプリケーションを実行状態にします。
        - **引数**: なし
        - **戻り値**: なし

## 関数呼び出し階層ツリー
```
main.py (アプリケーションのエントリポイント)
├── parse_args()                      # コマンドライン引数の解析
├── config.load_config()              # 設定ファイルの読み込み
│   └── config.get_setting()          # 個別設定値の取得
├── gui.create_gui()                  # GUIの初期化と構築
│   └── (内部でtkinterのウィジェットを生成・配置)
├── (メインループ内で定期的に実行)
│   ├── window_monitor.get_active_window_title() # アクティブウィンドウタイトルの取得
│   ├── score_tracker.update_score()  # 取得したタイトルに基づきスコアを更新
│   │   └── score_tracker.get_current_status() # 現在の活動ステータスを取得
│   └── gui.update_display()          # 最新のスコアとステータスをGUIに表示
└── gui.start_gui_loop()              # GUIイベントループの開始

---
Generated at: 2026-01-08 07:05:58 JST
