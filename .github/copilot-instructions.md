# cat-window-watcher 向け GitHub Copilot Instructions

## プロジェクト概要

cat-window-watcher は、アクティブなウィンドウの変化を監視し、ウィンドウの状態に基づいてアクションを実行する Python ベースのウィンドウ監視ツールです。

## コードスタイルと規約

### Python スタイル

- Python 3.12+ 互換の構文を使用する
- PEP 8 スタイルガイドラインに従う
- 分かりやすい変数名と関数名を使用する
- 実行可能スクリプトの先頭に shebang `#!/usr/bin/env python3` を含める
- 最大限の互換性のために相対インポートと絶対インポートの両方をサポートする：
  ```python
  try:
      from .module import Class
  except ImportError:
      from module import Class
  ```

### ドキュメント

- 全てのクラスとパブリックメソッドに docstring を追加する
- 明確な説明でトリプルクォート文字列を使用する
- 該当する場合は docstring に Args、Returns、Raises セクションを含める
- 例のフォーマット：
  ```python
  def method_name(self, param):
      """簡潔な説明。

      Args:
          param: パラメータの説明

      Returns:
          type: 戻り値の説明

      Raises:
          ErrorType: エラーが発生する条件の説明
      """
  ```

### コメント

- 複雑なロジックや自明でない動作を説明するコメントを追加する
- インラインコメントは控えめに、必要な場合のみ使用する
- 過剰なコメントよりも自己説明的なコードを優先する

## テスト

### テストフレームワーク

- 全てのテストに Python 組み込みの `unittest` フレームワークを使用する
- 全てのテストファイルを `tests/` ディレクトリに配置する
- テストファイル名にプレフィックス `test_` を付ける（例：`test_feature.py`）
- `test_` で始まる分かりやすいテストメソッド名を使用する

### テスト構造

- `unittest.TestCase` を継承したテストクラスを作成する
- テストフィクスチャには `setUp()` を使用する
- クリーンアップには `tearDown()` を使用する
- 一時テストディレクトリには `tempfile.mkdtemp()` を使用する
- テスト後に一時ファイルをクリーンアップする

### テストカバレッジ

- 全ての新機能とバグ修正にテストを書く
- ポジティブケースとネガティブケースの両方を含める
- エッジケースとエラー条件をテストする
- エラーメッセージと例外処理を検証する

## 設定

### TOML 設定

- 全ての設定ファイルに TOML 形式を使用する
- 設定はウィンドウ監視設定をサポートする必要がある

## アーキテクチャ

### モジュール構成

- モジュールは単一責任に焦点を当てる
- インスタンス状態を必要としないユーティリティ関数には静的メソッドを使用する
- 情報豊富なエラーメッセージで優雅にエラーを処理する
- ユーザー向け出力とログには `print()` を使用する

## エラーハンドリング

### 設定エラー

- 設定ファイルが見つからない場合は `FileNotFoundError` をキャッチする
- 無効な TOML 構文の場合は `toml.TomlDecodeError` をキャッチする
- ユーザーに明確なエラーメッセージを出力する
- 致命的なエラーには `sys.exit(1)` で終了する

### 実行時エラー

- ファイルシステム操作には `OSError` を処理する
- 一般的な例外をキャッチし、有用なエラーメッセージを提供する
- 非致命的エラーが発生した場合は動作を継続する

## 互換性

### プラットフォームサポート

- Linux、macOS、Windows をサポートする
- クロスプラットフォームのファイルパス処理には `os.path` を使用する
- プラットフォーム固有の機能を複数のプラットフォームでテストする

### Python バージョン

- Python 3.12+ との互換性を維持する
- Python 3.12+ で利用可能な現代的な Python 機能を使用する
- 最小 Python バージョン要件を文書化する

## コードフォーマットと品質

### 変更をコミットする前に

**重要**: Python コードの変更をコミットする前に、必ず以下のコマンドを実行してください：

```bash
# Ruff でコードをフォーマット
ruff format src/ tests/

# 自動修正可能な lint 問題を修正
ruff check --fix src/ tests/

# フォーマットと lint の検証（エラーなしで通過する必要がある）
ruff format --check src/ tests/
ruff check src/ tests/
```

これらのステップは全てのコード変更において**必須**です。コードフォーマットを怠ると以下の結果になります：
- PR レビューの遅延
- メンテナーによる手動フォーマットが必要
- PR 拒否の可能性

### なぜこれが重要か

- プロジェクトは Ruff を使用して一貫したコードスタイルを強制します
- コミット前の手動フォーマットが最も安全で効率的なアプローチです

## ベストプラクティス

- 明確な変数名で自己説明的なコードを書く
- 関数を小さく焦点を絞って保つ
- 早すぎる最適化を避ける
- コミット前に変更を十分にテストする
- **コミット前に必ず ruff format と ruff check を実行する**
- 意味のあるコミットメッセージを使用する
- 既存のコードパターンと慣例に従う

# プルリクエストとレビュー
- プルリクエストは日本語で記述してください
- レビューは日本語で記述してください
